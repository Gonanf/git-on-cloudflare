import{e as o,a as t,c as e,b as s,r as a,G as n}from"../../../../nitro/nitro.mjs";const r=o(async o=>{const r=t(o,"Git-Protocol");if(!/version=2/.test(r)||!r)throw e({statusCode:400,statusMessage:"Not supported protocol version"});const d=s(o,"owner"),i=s(o,"repo"),c=await a(o),l=(new n).parsePKT((new TextEncoder).encode(c)).parseCommand();if(!(null==l?void 0:l.command))throw e({statusCode:400,statusMessage:"Command not found"});if(console.log(l),"ls-refs"===l.command){const t=o.context.cloudflare.env,e=t.DO.idFromName(d+"/"+i),s=t.DO.get(e);await s.storage.get("head");const a=await s.storage.get("refs"),n=(null==stored?void 0:stored.target)||"refs/heads/main",r=a.find(o=>o.name===n),c=r?{target:n,oid:r.oid}:{target:n,unborn:!0};return new Response(c,{status:200,headers:{"Content-Type":"application/x-git-upload-pack-result","Cache-Control":"no-cache"}})}});export{r as default};
//# sourceMappingURL=git-upload-pack.post.mjs.map
